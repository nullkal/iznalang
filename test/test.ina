rainbowdash = LoadPNG("rainbowdash.png")
pinkiepie   = LoadPNG("pinkiepie.png")

# Closure
Counter = \() do
  count = 0
  \() do
    count += 1
  end
end()

pinkie_arr = []
AddPinkie  = \() do
  pinkie_arr[] = {
    x : rand() * (800 - 64),
    y : 320,
    dy: -20,
    origin_y: 320
  }
  print("Fun!! x" + ArraySize(pinkie_arr) + "\n")
end

x = 96
y = 96
count = 0
MainLoop(\() do
  if KeyIsHolded("UP")
    y -= 8
  end
  if KeyIsHolded("DOWN")
    y += 8
  end
  if KeyIsHolded("LEFT")
    x -= 8
  end
  if KeyIsHolded("RIGHT")
    x += 8
  end

  if count % 30 == 0
    AddPinkie()
  end

  if count % 15 == 0
    print("counter: " + Counter() + "\n")
  end

  i = 0
  while i < ArraySize(pinkie_arr)
    Draw(pinkiepie, pinkie_arr[i]["x"], pinkie_arr[i]["y"])
    pinkie_arr[i]["y"] = pinkie_arr[i]["y"] + pinkie_arr[i]["dy"]
    if pinkie_arr[i]["y"] < pinkie_arr[i]["origin_y"]
      pinkie_arr[i]["dy"] = pinkie_arr[i]["dy"] + 1
    else
      pinkie_arr[i]["dy"] = -20
    end
    i = i + 1
  end

  Draw(rainbowdash, x, y)
  count += 1
end)

